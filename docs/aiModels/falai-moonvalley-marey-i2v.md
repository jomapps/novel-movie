# fal.ai Moonvalley Marey I2V - Image to Video Model

> Generate a video starting from an image as the first frame with Marey, a generative video model trained exclusively on fully licensed data.

## Model Overview

- **Model ID**: `moonvalley/marey/i2v`
- **Endpoint**: `https://fal.run/moonvalley/marey/i2v`
- **Category**: Image-to-Video
- **Kind**: Inference
- **Version**: Marey Realism V1.5

## Key Features

- **Image-to-Video Generation**: Creates videos starting from a provided image as the first frame
- **High Quality Output**: Trained exclusively on fully licensed data
- **Flexible Dimensions**: Multiple aspect ratios supported
- **Configurable Duration**: 5s or 10s video options
- **Advanced Prompting**: Supports detailed scene descriptions with foreground/middleground/background specification

## Input Parameters

### Required Parameters

| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `prompt` | `string` | The prompt to generate a video from | "Detailed Description: In a hidden jungle grotto..." |
| `image_url` | `string` | The URL of the image to use as the first frame | "https://example.com/image.png" |

### Optional Parameters

| Parameter | Type | Default | Options | Description |
|-----------|------|---------|---------|-------------|
| `dimensions` | `DimensionsEnum` | `"1920x1080"` | `"1920x1080"`, `"1080x1920"`, `"1152x1152"`, `"1536x1152"`, `"1152x1536"` | Video dimensions in width x height format |
| `duration` | `DurationEnum` | `"5s"` | `"5s"`, `"10s"` | Duration of the generated video |
| `negative_prompt` | `string` | `"<synthetic> <scene cut> low-poly, flat shader, bad rigging, stiff animation, uncanny eyes, low-quality textures, looping glitch, cheap effect, overbloom, bloom spam, default lighting, game asset, stiff face, ugly specular, AI artifacts"` | - | Negative prompt to guide away from undesirable features |
| `seed` | `integer` | `9` | Any integer, -1 for random | Seed for random number generation |

## Output Schema

### Response Format

```json
{
  "video": {
    "url": "string",
    "content_type": "string",
    "file_name": "string", 
    "file_size": number
  }
}
```

| Field | Type | Description |
|-------|------|-------------|
| `video.url` | `string` | URL to download the generated video |
| `video.content_type` | `string` | MIME type of the video file |
| `video.file_name` | `string` | Generated filename |
| `video.file_size` | `number` | File size in bytes |

## JavaScript Implementation

### Installation

```bash
npm install --save @fal-ai/client
```

### Basic Usage

```javascript
import { fal } from "@fal-ai/client";

const result = await fal.subscribe("moonvalley/marey/i2v", {
  input: {
    prompt: "Detailed Description: In a hidden jungle grotto, a majestic waterfall plunges into a dark, serene pool below. Ethereal sunbeams slice through the dense canopy high above, illuminating the swirling mist generated by the powerful cascade. The light rays dance across the scene, highlighting the vibrant green foliage that clings to the dark, wet rock walls. The constant roar of the falling water echoes through the secluded space, as the surface of the pool ripples and churns from the impact, creating a mesmerizing display of nature's raw power and tranquil beauty. Background: Brilliant sunbeams pierce through an opening in the dense jungle canopy, their ethereal rays shifting and shimmering as they cut through the misty air. Middleground: A powerful column of white water cascades down a dark, foliage-covered cliff face, creating a stark contrast with the shadowy recesses of the grotto. Foreground: The waterfall crashes into a dark, churning pool of water, sending up a fine spray and creating ever-expanding ripples across the surface.",
    image_url: "https://d1kaxrqq3vfrw5.cloudfront.net/fal-launch-assets/guide-assets/fal-i2v-example-input.png"
  },
  logs: true,
  onQueueUpdate: (update) => {
    if (update.status === "IN_PROGRESS") {
      update.logs.map((log) => log.message).forEach(console.log);
    }
  },
});

console.log(result.data);
console.log(result.requestId);
```

### Advanced Configuration

```javascript
import { fal } from "@fal-ai/client";

const generateVideo = async (imageUrl, prompt, options = {}) => {
  const input = {
    prompt: prompt,
    image_url: imageUrl,
    dimensions: options.dimensions || "1920x1080",
    duration: options.duration || "5s", 
    negative_prompt: options.negativePrompt || "<synthetic> <scene cut> low-poly, flat shader, bad rigging, stiff animation, uncanny eyes, low-quality textures, looping glitch, cheap effect, overbloom, bloom spam, default lighting, game asset, stiff face, ugly specular, AI artifacts",
    seed: options.seed !== undefined ? options.seed : 9
  };

  try {
    const result = await fal.subscribe("moonvalley/marey/i2v", {
      input,
      logs: true,
      onQueueUpdate: (update) => {
        if (update.status === "IN_PROGRESS") {
          update.logs.map((log) => log.message).forEach(console.log);
        }
      },
    });

    return {
      success: true,
      data: result.data,
      requestId: result.requestId
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
};

// Usage example
const videoResult = await generateVideo(
  "https://example.com/my-image.jpg",
  "A serene lake with gentle ripples, surrounded by mountains at sunset",
  {
    dimensions: "1920x1080",
    duration: "10s",
    seed: -1 // Random seed
  }
);

if (videoResult.success) {
  console.log("Video generated:", videoResult.data.video.url);
} else {
  console.error("Error:", videoResult.error);
}
```

### TypeScript Interface

```typescript
interface MareyI2VInput {
  prompt: string;
  image_url: string;
  dimensions?: "1920x1080" | "1080x1920" | "1152x1152" | "1536x1152" | "1152x1536";
  duration?: "5s" | "10s";
  negative_prompt?: string;
  seed?: number;
}

interface MareyI2VOutput {
  video: {
    url: string;
    content_type: string;
    file_name: string;
    file_size: number;
  };
}

interface MareyI2VOptions {
  dimensions?: MareyI2VInput['dimensions'];
  duration?: MareyI2VInput['duration'];
  negativePrompt?: string;
  seed?: number;
}
```

### Error Handling

```javascript
import { fal } from "@fal-ai/client";

const generateVideoWithErrorHandling = async (imageUrl, prompt) => {
  try {
    const result = await fal.subscribe("moonvalley/marey/i2v", {
      input: {
        prompt,
        image_url: imageUrl
      },
      logs: true,
      onQueueUpdate: (update) => {
        console.log("Queue status:", update.status);
        if (update.status === "IN_PROGRESS") {
          update.logs?.forEach(log => console.log("Log:", log.message));
        }
      },
    });

    return {
      success: true,
      video: result.data.video,
      requestId: result.requestId
    };

  } catch (error) {
    console.error("fal.ai API error:", error);
    
    // Handle different error types
    if (error.status === 400) {
      return { success: false, error: "Invalid input parameters" };
    } else if (error.status === 401) {
      return { success: false, error: "Authentication failed - check FAL_KEY" };
    } else if (error.status === 429) {
      return { success: false, error: "Rate limit exceeded" };
    } else {
      return { success: false, error: error.message || "Unknown error occurred" };
    }
  }
};
```

## Request Examples

### Minimal Request

```json
{
  "prompt": "A peaceful garden scene with flowers swaying gently in the breeze",
  "image_url": "https://example.com/garden.jpg"
}
```

### Full Configuration Request

```json
{
  "prompt": "Detailed Description: In a hidden jungle grotto, a majestic waterfall plunges into a dark, serene pool below. Ethereal sunbeams slice through the dense canopy high above, illuminating the swirling mist generated by the powerful cascade. The light rays dance across the scene, highlighting the vibrant green foliage that clings to the dark, wet rock walls. The constant roar of the falling water echoes through the secluded space, as the surface of the pool ripples and churns from the impact, creating a mesmerizing display of nature's raw power and tranquil beauty. Background: Brilliant sunbeams pierce through an opening in the dense jungle canopy, their ethereal rays shifting and shimmering as they cut through the misty air. Middleground: A powerful column of white water cascades down a dark, foliage-covered cliff face, creating a stark contrast with the shadowy recesses of the grotto. Foreground: The waterfall crashes into a dark, churning pool of water, sending up a fine spray and creating ever-expanding ripples across the surface.",
  "dimensions": "1920x1080",
  "duration": "10s",
  "negative_prompt": "<synthetic> <scene cut> low-poly, flat shader, bad rigging, stiff animation, uncanny eyes, low-quality textures, looping glitch, cheap effect, overbloom, bloom spam, default lighting, game asset, stiff face, ugly specular, AI artifacts",
  "seed": 42,
  "image_url": "https://example.com/waterfall-scene.jpg"
}
```

## Response Examples

### Success Response

```json
{
  "video": {
    "url": "https://fal.media/files/elephant/xyz123.mp4",
    "content_type": "video/mp4",
    "file_name": "marey_video_xyz123.mp4",
    "file_size": 15728640
  }
}
```

## Best Practices

### Prompt Engineering

1. **Detailed Descriptions**: Use comprehensive scene descriptions for better results
2. **Structured Format**: Follow the Background/Middleground/Foreground structure when applicable
3. **Action Description**: Clearly describe the type of motion or animation desired
4. **Scene Context**: Provide environmental and atmospheric details

### Technical Considerations

1. **Image Quality**: Use high-resolution source images for best results
2. **Aspect Ratios**: Choose dimensions that match your intended use case
3. **Duration**: Longer durations (10s) require more processing time
4. **Seed Management**: Use fixed seeds for reproducible results, -1 for variation

### Error Prevention

1. **Image URLs**: Ensure image URLs are publicly accessible
2. **File Formats**: Use common image formats (JPG, PNG, WebP)
3. **API Key**: Set `FAL_KEY` environment variable for authentication
4. **Rate Limits**: Implement proper retry logic for production use

## Limitations

- Maximum video duration: 10 seconds
- Image must be provided via publicly accessible URL
- Processing time varies based on complexity and queue status
- Limited to specified dimension ratios

## Integration Notes

- Uses fal.ai's queue system for long-running operations
- Supports real-time progress updates via `onQueueUpdate` callback
- Returns downloadable video file URL upon completion
- Compatible with both browser and Node.js environments

## Related Resources

- [Model Playground](https://fal.ai/models/moonvalley/marey/i2v)
- [API Documentation](https://fal.ai/models/moonvalley/marey/i2v/api)
- [fal.ai Platform Documentation](https://docs.fal.ai)
- [JavaScript Client Documentation](https://docs.fal.ai/clients/javascript)
